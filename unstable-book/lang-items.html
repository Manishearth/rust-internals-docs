<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>lang_items - </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

        <!-- MathJax -->
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li class="affix"><a href="the-unstable-book.html">The Unstable Book</a></li><li><a href="abi-msp430-interrupt.html"><strong>1.</strong> abi_msp430_interrupt</a></li><li><a href="abi-ptx.html"><strong>2.</strong> abi_ptx</a></li><li><a href="abi-sysv64.html"><strong>3.</strong> abi_sysv64</a></li><li><a href="abi-unadjusted.html"><strong>4.</strong> abi_unadjusted</a></li><li><a href="abi-vectorcall.html"><strong>5.</strong> abi_vectorcall</a></li><li><a href="abi-x86-interrupt.html"><strong>6.</strong> abi_x86_interrupt</a></li><li><a href="advanced-slice-patterns.html"><strong>7.</strong> advanced_slice_patterns</a></li><li><a href="alloc-jemalloc.html"><strong>8.</strong> alloc_jemalloc</a></li><li><a href="alloc-system.html"><strong>9.</strong> alloc_system</a></li><li><a href="allocator.html"><strong>10.</strong> allocator</a></li><li><a href="allow-internal-unstable.html"><strong>11.</strong> allow_internal_unstable</a></li><li><a href="asm.html"><strong>12.</strong> asm</a></li><li><a href="associated-consts.html"><strong>13.</strong> associated_consts</a></li><li><a href="associated-type-defaults.html"><strong>14.</strong> associated_type_defaults</a></li><li><a href="attr-literals.html"><strong>15.</strong> attr_literals</a></li><li><a href="box-patterns.html"><strong>16.</strong> box_patterns</a></li><li><a href="box-syntax.html"><strong>17.</strong> box_syntax</a></li><li><a href="cfg-target-feature.html"><strong>18.</strong> cfg_target_feature</a></li><li><a href="cfg-target-has-atomic.html"><strong>19.</strong> cfg_target_has_atomic</a></li><li><a href="cfg-target-thread-local.html"><strong>20.</strong> cfg_target_thread_local</a></li><li><a href="cfg-target-vendor.html"><strong>21.</strong> cfg_target_vendor</a></li><li><a href="compiler-builtins.html"><strong>22.</strong> compiler_builtins</a></li><li><a href="concat-idents.html"><strong>23.</strong> concat_idents</a></li><li><a href="conservative-impl-trait.html"><strong>24.</strong> conservative_impl_trait</a></li><li><a href="const-fn.html"><strong>25.</strong> const_fn</a></li><li><a href="const-indexing.html"><strong>26.</strong> const_indexing</a></li><li><a href="custom-attribute.html"><strong>27.</strong> custom_attribute</a></li><li><a href="custom-derive.html"><strong>28.</strong> custom_derive</a></li><li><a href="default-type-parameter-fallback.html"><strong>29.</strong> default_type_parameter_fallback</a></li><li><a href="drop-types-in-const.html"><strong>30.</strong> drop_types_in_const</a></li><li><a href="dropck-eyepatch.html"><strong>31.</strong> dropck_eyepatch</a></li><li><a href="dropck-parametricity.html"><strong>32.</strong> dropck_parametricity</a></li><li><a href="exclusive-range-pattern.html"><strong>33.</strong> exclusive_range_pattern</a></li><li><a href="field-init-shorthand.html"><strong>34.</strong> field_init_shorthand</a></li><li><a href="fundamental.html"><strong>35.</strong> fundamental</a></li><li><a href="generic-param-attrs.html"><strong>36.</strong> generic_param_attrs</a></li><li><a href="i128-type.html"><strong>37.</strong> i128_type</a></li><li><a href="inclusive-range-syntax.html"><strong>38.</strong> inclusive_range_syntax</a></li><li><a href="intrinsics.html"><strong>39.</strong> intrinsics</a></li><li><a href="lang-items.html" class="active"><strong>40.</strong> lang_items</a></li><li><a href="link-args.html"><strong>41.</strong> link_args</a></li><li><a href="link-cfg.html"><strong>42.</strong> link_cfg</a></li><li><a href="link-llvm-intrinsics.html"><strong>43.</strong> link_llvm_intrinsics</a></li><li><a href="linkage.html"><strong>44.</strong> linkage</a></li><li><a href="log-syntax.html"><strong>45.</strong> log_syntax</a></li><li><a href="loop-break-value.html"><strong>46.</strong> loop_break_value</a></li><li><a href="macro-reexport.html"><strong>47.</strong> macro_reexport</a></li><li><a href="main.html"><strong>48.</strong> main</a></li><li><a href="naked-functions.html"><strong>49.</strong> naked_functions</a></li><li><a href="needs-allocator.html"><strong>50.</strong> needs_allocator</a></li><li><a href="needs-panic-runtime.html"><strong>51.</strong> needs_panic_runtime</a></li><li><a href="never-type.html"><strong>52.</strong> never_type</a></li><li><a href="no-core.html"><strong>53.</strong> no_core</a></li><li><a href="no-debug.html"><strong>54.</strong> no_debug</a></li><li><a href="non-ascii-idents.html"><strong>55.</strong> non_ascii_idents</a></li><li><a href="omit-gdb-pretty-printer-section.html"><strong>56.</strong> omit_gdb_pretty_printer_section</a></li><li><a href="on-unimplemented.html"><strong>57.</strong> on_unimplemented</a></li><li><a href="optin-builtin-traits.html"><strong>58.</strong> optin_builtin_traits</a></li><li><a href="panic-runtime.html"><strong>59.</strong> panic_runtime</a></li><li><a href="placement-in-syntax.html"><strong>60.</strong> placement_in_syntax</a></li><li><a href="platform-intrinsics.html"><strong>61.</strong> platform_intrinsics</a></li><li><a href="plugin.html"><strong>62.</strong> plugin</a></li><li><a href="plugin-registrar.html"><strong>63.</strong> plugin_registrar</a></li><li><a href="prelude-import.html"><strong>64.</strong> prelude_import</a></li><li><a href="proc-macro.html"><strong>65.</strong> proc_macro</a></li><li><a href="pub-restricted.html"><strong>66.</strong> pub_restricted</a></li><li><a href="quote.html"><strong>67.</strong> quote</a></li><li><a href="relaxed-adts.html"><strong>68.</strong> relaxed_adts</a></li><li><a href="repr-simd.html"><strong>69.</strong> repr_simd</a></li><li><a href="rustc-attrs.html"><strong>70.</strong> rustc_attrs</a></li><li><a href="rustc-diagnostic-macros.html"><strong>71.</strong> rustc_diagnostic_macros</a></li><li><a href="sanitizer-runtime.html"><strong>72.</strong> sanitizer_runtime</a></li><li><a href="simd.html"><strong>73.</strong> simd</a></li><li><a href="simd-ffi.html"><strong>74.</strong> simd_ffi</a></li><li><a href="slice-patterns.html"><strong>75.</strong> slice_patterns</a></li><li><a href="sort-unstable.html"><strong>76.</strong> sort_unstable</a></li><li><a href="specialization.html"><strong>77.</strong> specialization</a></li><li><a href="staged-api.html"><strong>78.</strong> staged_api</a></li><li><a href="start.html"><strong>79.</strong> start</a></li><li><a href="static-nobundle.html"><strong>80.</strong> static_nobundle</a></li><li><a href="static-recursion.html"><strong>81.</strong> static_recursion</a></li><li><a href="stmt-expr-attributes.html"><strong>82.</strong> stmt_expr_attributes</a></li><li><a href="struct-field-attributes.html"><strong>83.</strong> struct_field_attributes</a></li><li><a href="structural-match.html"><strong>84.</strong> structural_match</a></li><li><a href="target-feature.html"><strong>85.</strong> target_feature</a></li><li><a href="test.html"><strong>86.</strong> test</a></li><li><a href="thread-local.html"><strong>87.</strong> thread_local</a></li><li><a href="trace-macros.html"><strong>88.</strong> trace_macros</a></li><li><a href="type-ascription.html"><strong>89.</strong> type_ascription</a></li><li><a href="unboxed-closures.html"><strong>90.</strong> unboxed_closures</a></li><li><a href="untagged-unions.html"><strong>91.</strong> untagged_unions</a></li><li><a href="unwind-attributes.html"><strong>92.</strong> unwind_attributes</a></li><li><a href="use-extern-macros.html"><strong>93.</strong> use_extern_macros</a></li><li><a href="windows-subsystem.html"><strong>94.</strong> windows_subsystem</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                <div id="content" class="content">
                    <a class="header" href="lang-items.html#lang_items" name="lang_items"><h1><code>lang_items</code></h1></a>
<p>The tracking issue for this feature is: None.</p>
<hr />
<p>The <code>rustc</code> compiler has certain pluggable operations, that is,
functionality that isn't hard-coded into the language, but is
implemented in libraries, with a special marker to tell the compiler
it exists. The marker is the attribute <code>#[lang = &quot;...&quot;]</code> and there are
various different values of <code>...</code>, i.e. various different 'lang
items'.</p>
<p>For example, <code>Box</code> pointers require two lang items, one for allocation
and one for deallocation. A freestanding program that uses the <code>Box</code>
sugar for dynamic allocations via <code>malloc</code> and <code>free</code>:</p>
<pre><code class="language-rust ignore">#![feature(lang_items, box_syntax, start, libc, core_intrinsics)]
#![no_std]
use core::intrinsics;

extern crate libc;

#[lang = &quot;owned_box&quot;]
pub struct Box&lt;T&gt;(*mut T);

#[lang = &quot;exchange_malloc&quot;]
unsafe fn allocate(size: usize, _align: usize) -&gt; *mut u8 {
    let p = libc::malloc(size as libc::size_t) as *mut u8;

    // Check if `malloc` failed:
    if p as usize == 0 {
        intrinsics::abort();
    }

    p
}

#[lang = &quot;exchange_free&quot;]
unsafe fn deallocate(ptr: *mut u8, _size: usize, _align: usize) {
    libc::free(ptr as *mut libc::c_void)
}

#[lang = &quot;box_free&quot;]
unsafe fn box_free&lt;T: ?Sized&gt;(ptr: *mut T) {
    deallocate(ptr as *mut u8, ::core::mem::size_of_val(&amp;*ptr), ::core::mem::align_of_val(&amp;*ptr));
}

#[start]
fn main(argc: isize, argv: *const *const u8) -&gt; isize {
    let x = box 1;

    0
}

#[lang = &quot;eh_personality&quot;] extern fn rust_eh_personality() {}
#[lang = &quot;panic_fmt&quot;] extern fn rust_begin_panic() -&gt; ! { unsafe { intrinsics::abort() } }
# #[lang = &quot;eh_unwind_resume&quot;] extern fn rust_eh_unwind_resume() {}
# #[no_mangle] pub extern fn rust_eh_register_frames () {}
# #[no_mangle] pub extern fn rust_eh_unregister_frames () {}
</code></pre>
<p>Note the use of <code>abort</code>: the <code>exchange_malloc</code> lang item is assumed to
return a valid pointer, and so needs to do the check internally.</p>
<p>Other features provided by lang items include:</p>
<ul>
<li>overloadable operators via traits: the traits corresponding to the
<code>==</code>, <code>&lt;</code>, dereferencing (<code>*</code>) and <code>+</code> (etc.) operators are all
marked with lang items; those specific four are <code>eq</code>, <code>ord</code>,
<code>deref</code>, and <code>add</code> respectively.</li>
<li>stack unwinding and general failure; the <code>eh_personality</code>,
<code>eh_unwind_resume</code>, <code>fail</code> and <code>fail_bounds_checks</code> lang items.</li>
<li>the traits in <code>std::marker</code> used to indicate types of
various kinds; lang items <code>send</code>, <code>sync</code> and <code>copy</code>.</li>
<li>the marker types and variance indicators found in
<code>std::marker</code>; lang items <code>covariant_type</code>,
<code>contravariant_lifetime</code>, etc.</li>
</ul>
<p>Lang items are loaded lazily by the compiler; e.g. if one never uses
<code>Box</code> then there is no need to define functions for <code>exchange_malloc</code>
and <code>exchange_free</code>. <code>rustc</code> will emit an error when an item is needed
but not found in the current crate or any that it depends on.</p>
<p>Most lang items are defined by <code>libcore</code>, but if you're trying to build
an executable without the standard library, you'll run into the need
for lang items. The rest of this page focuses on this use-case, even though
lang items are a bit broader than that.</p>
<a class="header" href="lang-items.html#using-libc" name="using-libc"><h3>Using libc</h3></a>
<p>In order to build a <code>#[no_std]</code> executable we will need libc as a dependency.
We can specify this using our <code>Cargo.toml</code> file:</p>
<pre><code class="language-toml">[dependencies]
libc = { version = &quot;0.2.14&quot;, default-features = false }
</code></pre>
<p>Note that the default features have been disabled. This is a critical step -
<strong>the default features of libc include the standard library and so must be
disabled.</strong></p>
<a class="header" href="lang-items.html#writing-an-executable-without-stdlib" name="writing-an-executable-without-stdlib"><h3>Writing an executable without stdlib</h3></a>
<p>Controlling the entry point is possible in two ways: the <code>#[start]</code> attribute,
or overriding the default shim for the C <code>main</code> function with your own.</p>
<p>The function marked <code>#[start]</code> is passed the command line parameters
in the same format as C:</p>
<pre><code class="language-rust ignore">#![feature(lang_items, core_intrinsics)]
#![feature(start)]
#![no_std]
use core::intrinsics;

// Pull in the system libc library for what crt0.o likely requires.
extern crate libc;

// Entry point for this program.
#[start]
fn start(_argc: isize, _argv: *const *const u8) -&gt; isize {
    0
}

// These functions are used by the compiler, but not
// for a bare-bones hello world. These are normally
// provided by libstd.
#[lang = &quot;eh_personality&quot;]
#[no_mangle]
pub extern fn rust_eh_personality() {
}

// This function may be needed based on the compilation target.
#[lang = &quot;eh_unwind_resume&quot;]
#[no_mangle]
pub extern fn rust_eh_unwind_resume() {
}

#[lang = &quot;panic_fmt&quot;]
#[no_mangle]
pub extern fn rust_begin_panic(_msg: core::fmt::Arguments,
                               _file: &amp;'static str,
                               _line: u32) -&gt; ! {
    unsafe { intrinsics::abort() }
}
</code></pre>
<p>To override the compiler-inserted <code>main</code> shim, one has to disable it
with <code>#![no_main]</code> and then create the appropriate symbol with the
correct ABI and the correct name, which requires overriding the
compiler's name mangling too:</p>
<pre><code class="language-rust ignore">#![feature(lang_items, core_intrinsics)]
#![feature(start)]
#![no_std]
#![no_main]
use core::intrinsics;

// Pull in the system libc library for what crt0.o likely requires.
extern crate libc;

// Entry point for this program.
#[no_mangle] // ensure that this symbol is called `main` in the output
pub extern fn main(_argc: i32, _argv: *const *const u8) -&gt; i32 {
    0
}

// These functions are used by the compiler, but not
// for a bare-bones hello world. These are normally
// provided by libstd.
#[lang = &quot;eh_personality&quot;]
#[no_mangle]
pub extern fn rust_eh_personality() {
}

// This function may be needed based on the compilation target.
#[lang = &quot;eh_unwind_resume&quot;]
#[no_mangle]
pub extern fn rust_eh_unwind_resume() {
}

#[lang = &quot;panic_fmt&quot;]
#[no_mangle]
pub extern fn rust_begin_panic(_msg: core::fmt::Arguments,
                               _file: &amp;'static str,
                               _line: u32) -&gt; ! {
    unsafe { intrinsics::abort() }
}
</code></pre>
<a class="header" href="lang-items.html#more-about-the-language-items" name="more-about-the-language-items"><h2>More about the language items</h2></a>
<p>The compiler currently makes a few assumptions about symbols which are
available in the executable to call. Normally these functions are provided by
the standard library, but without it you must define your own. These symbols
are called &quot;language items&quot;, and they each have an internal name, and then a
signature that an implementation must conform to.</p>
<p>The first of these functions, <code>rust_eh_personality</code>, is used by the failure
mechanisms of the compiler. This is often mapped to GCC's personality function
(see the <a href="https://github.com/rust-lang/rust/blob/master/src/libpanic_unwind/gcc.rs">libstd implementation</a> for more information), but crates
which do not trigger a panic can be assured that this function is never
called. The language item's name is <code>eh_personality</code>.</p>
<p>The second function, <code>rust_begin_panic</code>, is also used by the failure mechanisms of the
compiler. When a panic happens, this controls the message that's displayed on
the screen. While the language item's name is <code>panic_fmt</code>, the symbol name is
<code>rust_begin_panic</code>.</p>
<p>A third function, <code>rust_eh_unwind_resume</code>, is also needed if the <code>custom_unwind_resume</code>
flag is set in the options of the compilation target. It allows customizing the
process of resuming unwind at the end of the landing pads. The language item's name
is <code>eh_unwind_resume</code>.</p>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a href="intrinsics.html" class="mobile-nav-chapters previous">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="link-args.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="intrinsics.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="link-args.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>
