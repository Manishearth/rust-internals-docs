<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>No stdlib</title>

    <link rel="stylesheet" type="text/css" href="rustbook.css">

    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    
                <div id="nav">
                    <button id="toggle-nav">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                    </button>
                </div>
<div id='toc' class='mobile-hidden'>
<ol class='chapter'>
<li><a  href='README.html'><b>1.</b> Introduction</a>
</li>
<li><a  href='getting-started.html'><b>2.</b> Getting Started</a>
</li>
<li><a  href='guessing-game.html'><b>3.</b> Tutorial: Guessing Game</a>
</li>
<li><a  href='syntax-and-semantics.html'><b>4.</b> Syntax and Semantics</a>
<ol class='section'>
<li><a  href='variable-bindings.html'><b>4.1.</b> Variable Bindings</a>
</li>
<li><a  href='functions.html'><b>4.2.</b> Functions</a>
</li>
<li><a  href='primitive-types.html'><b>4.3.</b> Primitive Types</a>
</li>
<li><a  href='comments.html'><b>4.4.</b> Comments</a>
</li>
<li><a  href='if.html'><b>4.5.</b> if</a>
</li>
<li><a  href='loops.html'><b>4.6.</b> Loops</a>
</li>
<li><a  href='vectors.html'><b>4.7.</b> Vectors</a>
</li>
<li><a  href='ownership.html'><b>4.8.</b> Ownership</a>
</li>
<li><a  href='references-and-borrowing.html'><b>4.9.</b> References and Borrowing</a>
</li>
<li><a  href='lifetimes.html'><b>4.10.</b> Lifetimes</a>
</li>
<li><a  href='mutability.html'><b>4.11.</b> Mutability</a>
</li>
<li><a  href='structs.html'><b>4.12.</b> Structs</a>
</li>
<li><a  href='enums.html'><b>4.13.</b> Enums</a>
</li>
<li><a  href='match.html'><b>4.14.</b> Match</a>
</li>
<li><a  href='patterns.html'><b>4.15.</b> Patterns</a>
</li>
<li><a  href='method-syntax.html'><b>4.16.</b> Method Syntax</a>
</li>
<li><a  href='strings.html'><b>4.17.</b> Strings</a>
</li>
<li><a  href='generics.html'><b>4.18.</b> Generics</a>
</li>
<li><a  href='traits.html'><b>4.19.</b> Traits</a>
</li>
<li><a  href='drop.html'><b>4.20.</b> Drop</a>
</li>
<li><a  href='if-let.html'><b>4.21.</b> if let</a>
</li>
<li><a  href='trait-objects.html'><b>4.22.</b> Trait Objects</a>
</li>
<li><a  href='closures.html'><b>4.23.</b> Closures</a>
</li>
<li><a  href='ufcs.html'><b>4.24.</b> Universal Function Call Syntax</a>
</li>
<li><a  href='crates-and-modules.html'><b>4.25.</b> Crates and Modules</a>
</li>
<li><a  href='const-and-static.html'><b>4.26.</b> `const` and `static`</a>
</li>
<li><a  href='attributes.html'><b>4.27.</b> Attributes</a>
</li>
<li><a  href='type-aliases.html'><b>4.28.</b> `type` aliases</a>
</li>
<li><a  href='casting-between-types.html'><b>4.29.</b> Casting between types</a>
</li>
<li><a  href='associated-types.html'><b>4.30.</b> Associated Types</a>
</li>
<li><a  href='unsized-types.html'><b>4.31.</b> Unsized Types</a>
</li>
<li><a  href='operators-and-overloading.html'><b>4.32.</b> Operators and Overloading</a>
</li>
<li><a  href='deref-coercions.html'><b>4.33.</b> Deref coercions</a>
</li>
<li><a  href='macros.html'><b>4.34.</b> Macros</a>
</li>
<li><a  href='raw-pointers.html'><b>4.35.</b> Raw Pointers</a>
</li>
<li><a  href='unsafe.html'><b>4.36.</b> `unsafe`</a>
</li>
</ol>
</li>
<li><a  href='effective-rust.html'><b>5.</b> Effective Rust</a>
<ol class='section'>
<li><a  href='the-stack-and-the-heap.html'><b>5.1.</b> The Stack and the Heap</a>
</li>
<li><a  href='testing.html'><b>5.2.</b> Testing</a>
</li>
<li><a  href='conditional-compilation.html'><b>5.3.</b> Conditional Compilation</a>
</li>
<li><a  href='documentation.html'><b>5.4.</b> Documentation</a>
</li>
<li><a  href='iterators.html'><b>5.5.</b> Iterators</a>
</li>
<li><a  href='concurrency.html'><b>5.6.</b> Concurrency</a>
</li>
<li><a  href='error-handling.html'><b>5.7.</b> Error Handling</a>
</li>
<li><a  href='choosing-your-guarantees.html'><b>5.8.</b> Choosing your Guarantees</a>
</li>
<li><a  href='ffi.html'><b>5.9.</b> FFI</a>
</li>
<li><a  href='borrow-and-asref.html'><b>5.10.</b> Borrow and AsRef</a>
</li>
<li><a  href='release-channels.html'><b>5.11.</b> Release Channels</a>
</li>
<li><a  href='using-rust-without-the-standard-library.html'><b>5.12.</b> Using Rust without the standard library</a>
</li>
<li><a  href='procedural-macros.html'><b>5.13.</b> Procedural Macros (and custom derive)</a>
</li>
</ol>
</li>
<li><a  href='nightly-rust.html'><b>6.</b> Nightly Rust</a>
<ol class='section'>
<li><a  href='compiler-plugins.html'><b>6.1.</b> Compiler Plugins</a>
</li>
<li><a  href='inline-assembly.html'><b>6.2.</b> Inline Assembly</a>
</li>
<li><a class='active' href='no-stdlib.html'><b>6.3.</b> No stdlib</a>
</li>
<li><a  href='intrinsics.html'><b>6.4.</b> Intrinsics</a>
</li>
<li><a  href='lang-items.html'><b>6.5.</b> Lang items</a>
</li>
<li><a  href='advanced-linking.html'><b>6.6.</b> Advanced linking</a>
</li>
<li><a  href='benchmark-tests.html'><b>6.7.</b> Benchmark Tests</a>
</li>
<li><a  href='box-syntax-and-patterns.html'><b>6.8.</b> Box Syntax and Patterns</a>
</li>
<li><a  href='slice-patterns.html'><b>6.9.</b> Slice Patterns</a>
</li>
<li><a  href='associated-constants.html'><b>6.10.</b> Associated Constants</a>
</li>
<li><a  href='custom-allocators.html'><b>6.11.</b> Custom Allocators</a>
</li>
</ol>
</li>
<li><a  href='glossary.html'><b>7.</b> Glossary</a>
</li>
<li><a  href='syntax-index.html'><b>8.</b> Syntax Index</a>
</li>
<li><a  href='bibliography.html'><b>9.</b> Bibliography</a>
</li>
</ol>
</div>
<div id='page-wrapper'>
<div id='page'>


    <h1 class="title">No stdlib</h1>
    <p>Rust’s standard library provides a lot of useful functionality, but assumes
support for various features of its host system: threads, networking, heap
allocation, and others. There are systems that do not have these features,
however, and Rust can work with those too! To do so, we tell Rust that we
don’t want to use the standard library via an attribute: <code>#![no_std]</code>.</p>

<blockquote>
<p>Note: This feature is technically stable, but there are some caveats. For
one, you can build a <code>#![no_std]</code> <em>library</em> on stable, but not a <em>binary</em>.
For details on libraries without the standard library, see <a href="using-rust-without-the-standard-library.html">the chapter on
<code>#![no_std]</code></a></p>
</blockquote>

<p>Obviously there&#39;s more to life than just libraries: one can use
<code>#[no_std]</code> with an executable.</p>

<h3 id='using-libc' class='section-header'><a href='#using-libc'>Using libc</a></h3>
<p>In order to build a <code>#[no_std]</code> executable we will need libc as a dependency. We can specify
this using our <code>Cargo.toml</code> file:</p>

<pre><code class="language-toml">[dependencies]
libc = { version = &quot;0.2.14&quot;, default-features = false }
</code></pre>

<p>Note that the default features have been disabled. This is a critical step -
<strong>the default features of libc include the standard library and so must be
disabled.</strong></p>

<h3 id='writing-an-executable-without-stdlib' class='section-header'><a href='#writing-an-executable-without-stdlib'>Writing an executable without stdlib</a></h3>
<p>Controlling the entry point is possible in two ways: the <code>#[start]</code> attribute,
or overriding the default shim for the C <code>main</code> function with your own.</p>

<p>The function marked <code>#[start]</code> is passed the command line parameters
in the same format as C:</p>

<pre class='rust rust-example-rendered'>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>feature</span>(<span class='ident'>lang_items</span>, <span class='ident'>core_intrinsics</span>)]</span>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>feature</span>(<span class='ident'>start</span>)]</span>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>no_std</span>]</span>
<span class='kw'>use</span> <span class='ident'>core</span>::<span class='ident'>intrinsics</span>;

<span class='comment'>// Pull in the system libc library for what crt0.o likely requires.</span>
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>libc</span>;

<span class='comment'>// Entry point for this program.</span>
<span class='attribute'>#[<span class='ident'>start</span>]</span>
<span class='kw'>fn</span> <span class='ident'>start</span>(<span class='ident'>_argc</span>: <span class='ident'>isize</span>, <span class='ident'>_argv</span>: <span class='kw-2'>*</span><span class='kw'>const</span> <span class='kw-2'>*</span><span class='kw'>const</span> <span class='ident'>u8</span>) <span class='op'>-&gt;</span> <span class='ident'>isize</span> {
    <span class='number'>0</span>
}

<span class='comment'>// These functions are used by the compiler, but not</span>
<span class='comment'>// for a bare-bones hello world. These are normally</span>
<span class='comment'>// provided by libstd.</span>
<span class='attribute'>#[<span class='ident'>lang</span> <span class='op'>=</span> <span class='string'>&quot;eh_personality&quot;</span>]</span>
<span class='attribute'>#[<span class='ident'>no_mangle</span>]</span>
<span class='kw'>pub</span> <span class='kw'>extern</span> <span class='kw'>fn</span> <span class='ident'>rust_eh_personality</span>() {
}

<span class='comment'>// This function may be needed based on the compilation target.</span>
<span class='attribute'>#[<span class='ident'>lang</span> <span class='op'>=</span> <span class='string'>&quot;eh_unwind_resume&quot;</span>]</span>
<span class='attribute'>#[<span class='ident'>no_mangle</span>]</span>
<span class='kw'>pub</span> <span class='kw'>extern</span> <span class='kw'>fn</span> <span class='ident'>rust_eh_unwind_resume</span>() {
}

<span class='attribute'>#[<span class='ident'>lang</span> <span class='op'>=</span> <span class='string'>&quot;panic_fmt&quot;</span>]</span>
<span class='attribute'>#[<span class='ident'>no_mangle</span>]</span>
<span class='kw'>pub</span> <span class='kw'>extern</span> <span class='kw'>fn</span> <span class='ident'>rust_begin_panic</span>(<span class='ident'>_msg</span>: <span class='ident'>core</span>::<span class='ident'>fmt</span>::<span class='ident'>Arguments</span>,
                               <span class='ident'>_file</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;static</span> <span class='ident'>str</span>,
                               <span class='ident'>_line</span>: <span class='ident'>u32</span>) <span class='op'>-&gt;</span> <span class='op'>!</span> {
    <span class='kw'>unsafe</span> { <span class='ident'>intrinsics</span>::<span class='ident'>abort</span>() }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Bfeature(lang_items%2C%20core_intrinsics)%5D%0A%23!%5Bfeature(start)%5D%0Afn%20main()%20%7B%0A%23!%5Bno_std%5D%0Ause%20core%3A%3Aintrinsics%3B%0A%0A%2F%2F%20Pull%20in%20the%20system%20libc%20library%20for%20what%20crt0.o%20likely%20requires.%0Aextern%20crate%20libc%3B%0A%0A%2F%2F%20Entry%20point%20for%20this%20program.%0A%23%5Bstart%5D%0Afn%20start(_argc%3A%20isize%2C%20_argv%3A%20*const%20*const%20u8)%20-%3E%20isize%20%7B%0A%20%20%20%200%0A%7D%0A%0A%2F%2F%20These%20functions%20are%20used%20by%20the%20compiler%2C%20but%20not%0A%2F%2F%20for%20a%20bare-bones%20hello%20world.%20These%20are%20normally%0A%2F%2F%20provided%20by%20libstd.%0A%23%5Blang%20%3D%20%22eh_personality%22%5D%0A%23%5Bno_mangle%5D%0Apub%20extern%20fn%20rust_eh_personality()%20%7B%0A%7D%0A%0A%2F%2F%20This%20function%20may%20be%20needed%20based%20on%20the%20compilation%20target.%0A%23%5Blang%20%3D%20%22eh_unwind_resume%22%5D%0A%23%5Bno_mangle%5D%0Apub%20extern%20fn%20rust_eh_unwind_resume()%20%7B%0A%7D%0A%0A%23%5Blang%20%3D%20%22panic_fmt%22%5D%0A%23%5Bno_mangle%5D%0Apub%20extern%20fn%20rust_begin_panic(_msg%3A%20core%3A%3Afmt%3A%3AArguments%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_file%3A%20%26'static%20str%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_line%3A%20u32)%20-%3E%20!%20%7B%0A%20%20%20%20unsafe%20%7B%20intrinsics%3A%3Aabort()%20%7D%0A%7D%0A%7D&amp;version=nightly">Run</a></pre>

<p>To override the compiler-inserted <code>main</code> shim, one has to disable it
with <code>#![no_main]</code> and then create the appropriate symbol with the
correct ABI and the correct name, which requires overriding the
compiler&#39;s name mangling too:</p>

<pre class='rust rust-example-rendered'>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>feature</span>(<span class='ident'>lang_items</span>, <span class='ident'>core_intrinsics</span>)]</span>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>feature</span>(<span class='ident'>start</span>)]</span>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>no_std</span>]</span>
<span class='attribute'>#<span class='op'>!</span>[<span class='ident'>no_main</span>]</span>
<span class='kw'>use</span> <span class='ident'>core</span>::<span class='ident'>intrinsics</span>;

<span class='comment'>// Pull in the system libc library for what crt0.o likely requires.</span>
<span class='kw'>extern</span> <span class='kw'>crate</span> <span class='ident'>libc</span>;

<span class='comment'>// Entry point for this program.</span>
<span class='attribute'>#[<span class='ident'>no_mangle</span>]</span> <span class='comment'>// ensure that this symbol is called `main` in the output</span>
<span class='kw'>pub</span> <span class='kw'>extern</span> <span class='kw'>fn</span> <span class='ident'>main</span>(<span class='ident'>_argc</span>: <span class='ident'>i32</span>, <span class='ident'>_argv</span>: <span class='kw-2'>*</span><span class='kw'>const</span> <span class='kw-2'>*</span><span class='kw'>const</span> <span class='ident'>u8</span>) <span class='op'>-&gt;</span> <span class='ident'>i32</span> {
    <span class='number'>0</span>
}

<span class='comment'>// These functions are used by the compiler, but not</span>
<span class='comment'>// for a bare-bones hello world. These are normally</span>
<span class='comment'>// provided by libstd.</span>
<span class='attribute'>#[<span class='ident'>lang</span> <span class='op'>=</span> <span class='string'>&quot;eh_personality&quot;</span>]</span>
<span class='attribute'>#[<span class='ident'>no_mangle</span>]</span>
<span class='kw'>pub</span> <span class='kw'>extern</span> <span class='kw'>fn</span> <span class='ident'>rust_eh_personality</span>() {
}

<span class='comment'>// This function may be needed based on the compilation target.</span>
<span class='attribute'>#[<span class='ident'>lang</span> <span class='op'>=</span> <span class='string'>&quot;eh_unwind_resume&quot;</span>]</span>
<span class='attribute'>#[<span class='ident'>no_mangle</span>]</span>
<span class='kw'>pub</span> <span class='kw'>extern</span> <span class='kw'>fn</span> <span class='ident'>rust_eh_unwind_resume</span>() {
}

<span class='attribute'>#[<span class='ident'>lang</span> <span class='op'>=</span> <span class='string'>&quot;panic_fmt&quot;</span>]</span>
<span class='attribute'>#[<span class='ident'>no_mangle</span>]</span>
<span class='kw'>pub</span> <span class='kw'>extern</span> <span class='kw'>fn</span> <span class='ident'>rust_begin_panic</span>(<span class='ident'>_msg</span>: <span class='ident'>core</span>::<span class='ident'>fmt</span>::<span class='ident'>Arguments</span>,
                               <span class='ident'>_file</span>: <span class='kw-2'>&amp;</span><span class='lifetime'>&#39;static</span> <span class='ident'>str</span>,
                               <span class='ident'>_line</span>: <span class='ident'>u32</span>) <span class='op'>-&gt;</span> <span class='op'>!</span> {
    <span class='kw'>unsafe</span> { <span class='ident'>intrinsics</span>::<span class='ident'>abort</span>() }
}<a class="test-arrow" target="_blank" href="https://play.rust-lang.org/?code=%23!%5Bfeature(lang_items%2C%20core_intrinsics)%5D%0A%23!%5Bfeature(start)%5D%0A%23!%5Bno_std%5D%0A%23!%5Bno_main%5D%0Ause%20core%3A%3Aintrinsics%3B%0A%0A%2F%2F%20Pull%20in%20the%20system%20libc%20library%20for%20what%20crt0.o%20likely%20requires.%0Aextern%20crate%20libc%3B%0A%0A%2F%2F%20Entry%20point%20for%20this%20program.%0A%23%5Bno_mangle%5D%20%2F%2F%20ensure%20that%20this%20symbol%20is%20called%20%60main%60%20in%20the%20output%0Apub%20extern%20fn%20main(_argc%3A%20i32%2C%20_argv%3A%20*const%20*const%20u8)%20-%3E%20i32%20%7B%0A%20%20%20%200%0A%7D%0A%0A%2F%2F%20These%20functions%20are%20used%20by%20the%20compiler%2C%20but%20not%0A%2F%2F%20for%20a%20bare-bones%20hello%20world.%20These%20are%20normally%0A%2F%2F%20provided%20by%20libstd.%0A%23%5Blang%20%3D%20%22eh_personality%22%5D%0A%23%5Bno_mangle%5D%0Apub%20extern%20fn%20rust_eh_personality()%20%7B%0A%7D%0A%0A%2F%2F%20This%20function%20may%20be%20needed%20based%20on%20the%20compilation%20target.%0A%23%5Blang%20%3D%20%22eh_unwind_resume%22%5D%0A%23%5Bno_mangle%5D%0Apub%20extern%20fn%20rust_eh_unwind_resume()%20%7B%0A%7D%0A%0A%23%5Blang%20%3D%20%22panic_fmt%22%5D%0A%23%5Bno_mangle%5D%0Apub%20extern%20fn%20rust_begin_panic(_msg%3A%20core%3A%3Afmt%3A%3AArguments%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_file%3A%20%26'static%20str%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20_line%3A%20u32)%20-%3E%20!%20%7B%0A%20%20%20%20unsafe%20%7B%20intrinsics%3A%3Aabort()%20%7D%0A%7D%0A&amp;version=nightly">Run</a></pre>

<h2 id='more-about-the-language-items' class='section-header'><a href='#more-about-the-language-items'>More about the language items</a></h2>
<p>The compiler currently makes a few assumptions about symbols which are
available in the executable to call. Normally these functions are provided by
the standard library, but without it you must define your own. These symbols
are called &quot;language items&quot;, and they each have an internal name, and then a
signature that an implementation must conform to.</p>

<p>The first of these functions, <code>rust_eh_personality</code>, is used by the failure
mechanisms of the compiler. This is often mapped to GCC&#39;s personality function
(see the <a href="https://github.com/rust-lang/rust/blob/master/src/libpanic_unwind/gcc.rs">libstd implementation</a> for more information), but crates
which do not trigger a panic can be assured that this function is never
called. The language item&#39;s name is <code>eh_personality</code>.</p>

<p>The second function, <code>rust_begin_panic</code>, is also used by the failure mechanisms of the
compiler. When a panic happens, this controls the message that&#39;s displayed on
the screen. While the language item&#39;s name is <code>panic_fmt</code>, the symbol name is
<code>rust_begin_panic</code>.</p>

<p>A third function, <code>rust_eh_unwind_resume</code>, is also needed if the <code>custom_unwind_resume</code>
flag is set in the options of the compilation target. It allows customizing the
process of resuming unwind at the end of the landing pads. The language item&#39;s name
is <code>eh_unwind_resume</code>.</p>

    <script src='rustbook.js'></script>
</div></div>


</body>
</html>